[Service]
# Filesystem protection
ProtectSystem=full
ProtectHome=yes
PrivateTmp=no
ReadWritePaths=/var
ReadWritePaths=/etc/rancher
ReadWritePaths=/sys/fs/cgroup
ReadWritePaths=/etc/cni
ReadWritePaths=/var/lib/cni
ReadWritePaths=/cache
ReadWritePaths=/proc/sys/net/ipv4/conf
ReadWritePaths=/proc/sys/net/netfilter
ReadWritePaths=/proc/sys/kernel
ReadWritePaths=/proc/sys/vm
ReadWritePaths=/etc/kubernetes
ReadOnlyPaths=/usr /boot

# Mount restrictions
PrivateMounts=yes
MountFlags=slave

# Prevent new privileges
NoNewPrivileges=no  # k3s needs this for now, will restrict in containers

# Resource limits (optional)
TasksMax=infinity
LimitNOFILE=1048576
LimitNPROC=infinity

# Additional security
RestrictAddressFamilies=AF_UNIX AF_INET AF_INET6 AF_NETLINK
ProtectKernelTunables=yes
ProtectKernelModules=no
ProtectControlGroups=no
