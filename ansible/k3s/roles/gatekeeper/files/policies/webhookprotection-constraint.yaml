---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: WebhookProtection
metadata:
  name: protect-admission-webhooks
  labels:
    gatekeeper.sh/system: "yes"
spec:
  match:
    kinds:
      - apiGroups: ["admissionregistration.k8s.io"]
        kinds: ["ValidatingAdmissionWebhook", "MutatingAdmissionWebhook"]
      - apiGroups: ["apps"]
        kinds: ["Deployment"]
      - apiGroups: [""]
        kinds: ["Service", "ServiceAccount"]
      - apiGroups: ["rbac.authorization.k8s.io"]
        kinds: ["ClusterRole", "ClusterRoleBinding", "Role", "RoleBinding"]
      - apiGroups: ["apiextensions.k8s.io"]
        kinds: ["CustomResourceDefinition"]
  parameters:
    protectedWebhooks:
      - "gatekeeper-validating-webhook-configuration"
      - "gatekeeper-mutating-webhook-configuration"
      - "admission-controller-webhook"
    allowedOperations:
      - "GET"
      - "LIST"
      - "WATCH"