[Service]
# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true

# Filesystem access
ReadWritePaths=/var/log/attestation-service /run/attestation-service
ReadOnlyPaths=/etc/attestation-service /opt/sek8s

# Auto-create /run/attestation-service on service start
RuntimeDirectory=attestation-service
RuntimeDirectoryMode=0755
User=tdx-attest
Group=tdx-attest

# Kernel protection
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectControlGroups=true
ProtectKernelLogs=true
ProtectClock=true

# Network restrictions
RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX AF_VSOCK

# Namespace restrictions
RestrictNamespaces=true
LockPersonality=true
MemoryDenyWriteExecute=true
RestrictRealtime=true
RestrictSUIDSGID=true
RemoveIPC=true

# System call filtering
SystemCallFilter=@system-service
SystemCallFilter=~@privileged @resources @reboot @swap @module @mount @clock @cpu-emulation @debug @raw-io @obsolete

# Device access
PrivateDevices=false
DevicePolicy=auto

# User/Group restrictions
SupplementaryGroups=
PrivateUsers=true

# Resource limits
LimitNOFILE=65536
MemoryMax=500M
CPUQuota=50%
TasksMax=100