{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TEE VM Configuration Schema",
  "description": "Configuration schema for TEE VM deployment via quick-launch.sh",
  "type": "object",
  "required": ["vm", "miner", "network", "volumes"],
  "properties": {
    "vm": {
      "type": "object",
      "required": ["hostname"],
      "additionalProperties": false,
      "properties": {
        "hostname": {
          "type": "string",
          "description": "VM hostname - must be unique per miner hotkey",
          "minLength": 1,
          "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$"
        },
        "image": {
          "type": "string",
          "description": "Path to VM image (qcow2). If not specified, uses CHUTES_IMAGE env var or run-td default",
          "minLength": 1
        }
      }
    },
    "miner": {
      "type": "object",
      "required": ["ss58", "seed"],
      "additionalProperties": false,
      "properties": {
        "ss58": {
          "type": "string",
          "description": "Miner SS58 credential (bittensor address)",
          "minLength": 1
        },
        "seed": {
          "type": "string",
          "description": "Miner seed credential",
          "minLength": 1
        }
      }
    },
    "network": {
      "type": "object",
      "required": ["vm_ip", "bridge_ip", "dns", "public_interface"],
      "additionalProperties": false,
      "properties": {
        "vm_ip": {
          "type": "string",
          "description": "VM IP address",
          "format": "ipv4"
        },
        "bridge_ip": {
          "type": "string",
          "description": "Bridge IP address with CIDR (e.g., 192.168.100.1/24)",
          "pattern": "^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$"
        },
        "dns": {
          "type": "string",
          "description": "DNS server IP address",
          "format": "ipv4"
        },
        "public_interface": {
          "type": "string",
          "description": "Public network interface for NAT/forwarding",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "description": "Network type (tap or user mode)",
          "enum": ["tap", "user"],
          "default": "tap"
        },
        "ssh_port": {
          "type": "integer",
          "description": "SSH port for user mode networking",
          "minimum": 1024,
          "maximum": 65535,
          "default": 2222
        }
      }
    },
    "volumes": {
      "type": "object",
      "required": ["cache", "containerd"],
      "additionalProperties": false,
      "properties": {
        "cache": {
          "type": "object",
          "required": ["size"],
          "additionalProperties": false,
          "properties": {
            "size": {
              "type": "string",
              "description": "Cache volume size (e.g., 5000G, 1T)",
              "pattern": "^[0-9]+(K|M|G|T)$"
            },
            "path": {
              "type": "string",
              "description": "Path to cache volume. Empty string means auto-generate as cache-<hostname>.qcow2",
              "default": ""
            }
          }
        },
        "containerd": {
          "type": "object",
          "required": ["size"],
          "additionalProperties": false,
          "properties": {
            "size": {
              "type": "string",
              "description": "Containerd cache volume size (e.g., 500G, 1T)",
              "pattern": "^[0-9]+(K|M|G|T)$"
            },
            "path": {
              "type": "string",
              "description": "Path to containerd cache volume. Empty string means auto-generate as containerd-<hostname>.qcow2",
              "default": ""
            }
          }
        },
        "config": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "path": {
              "type": "string",
              "description": "Path to config volume. Empty string means auto-generate as config-<hostname>.qcow2",
              "default": ""
            }
          }
        }
      }
    },
    "devices": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "bind_devices": {
          "type": "boolean",
          "description": "Whether to bind GPU/NVSwitch devices for passthrough",
          "default": true
        }
      }
    },
    "runtime": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "foreground": {
          "type": "boolean",
          "description": "Run VM in foreground mode (blocks until VM exits)",
          "default": false
        }
      }
    }
  },
  "additionalProperties": false
}
